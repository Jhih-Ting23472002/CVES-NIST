export interface Vulnerability {
  cveId: string;
  description: string;
  severity: VulnerabilitySeverity;
  cvssScore: number;
  cvssVector?: string;
  publishedDate: string;
  lastModifiedDate: string;
  references: string[];
  affectedVersions: string[];
  fixedVersion?: string;
}

export interface PackageInfo {
  name: string;
  version: string;
  description?: string;
  type: 'dependency' | 'devDependency' | 'transitive';
  resolved?: string;
  integrity?: string;
  dev?: boolean;
  license?: string;
  // 用於識別多版本情況的唯一識別符
  packageKey?: string;
  // 標記是否為主要版本（用於多版本時的顯示優先順序）
  isPrimary?: boolean;
  // 版本來源資訊（例如：直接依賴 vs 間接依賴的路徑）
  dependencyPath?: string[];
}

export interface PackageVulnerability {
  packageName: string;
  currentVersion: string;
  description?: string;
  vulnerabilities: Vulnerability[];
  riskLevel: VulnerabilitySeverity;
  recommendedVersion?: string;
  alternatives?: PackageAlternative[];
  lastUpdated: Date;
  checkingUpdates?: boolean;
}

export interface PackageAlternative {
  name: string;
  description: string;
  securityScore?: number;
}

export interface ScanResult {
  totalPackages: number;
  scannedPackages: number;
  vulnerablePackages: PackageVulnerability[];
  summary: VulnerabilitySummary;
  scanDate: Date;
  duration: number;
  scanId: string;
}

export interface VulnerabilitySummary {
  critical: number;
  high: number;
  medium: number;
  low: number;
  safe: number;
}

export interface ScanProgress {
  current: number;
  total: number;
  percentage: number;
  currentPackage: string;
  estimatedTimeRemaining?: number;
}

export type VulnerabilitySeverity = 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW' | 'NONE';

export type ScanStatus = 'idle' | 'running' | 'paused' | 'completed' | 'error' | 'cancelled';

export interface ValidationResult {
  isValid: boolean;
  errors: string[];
  warnings: string[];
}

export interface ScanConfig {
  mode: 'fast' | 'balanced' | 'comprehensive';
  includeDirectDeps: boolean;
  includeDevDeps: boolean;
  includeTransitive: boolean;
  maxTransitiveDepth: number;
  skipCommonTools: boolean;
  onlyHighSeverity: boolean;
}

export const DEFAULT_SCAN_CONFIGS: Record<string, ScanConfig> = {
  fast: {
    mode: 'fast',
    includeDirectDeps: true,
    includeDevDeps: false,
    includeTransitive: false,
    maxTransitiveDepth: 0,
    skipCommonTools: true,
    onlyHighSeverity: true
  },
  balanced: {
    mode: 'balanced',
    includeDirectDeps: true,
    includeDevDeps: true,
    includeTransitive: true,
    maxTransitiveDepth: 1,
    skipCommonTools: true,
    onlyHighSeverity: false
  },
  comprehensive: {
    mode: 'comprehensive',
    includeDirectDeps: true,
    includeDevDeps: true,
    includeTransitive: true,
    maxTransitiveDepth: 99,
    skipCommonTools: false,
    onlyHighSeverity: false
  }
};

export interface ExportOptions {
  format: 'pdf' | 'csv' | 'json';
  includeOptions: {
    summary: boolean;
    vulnerabilities: boolean;
    recommendations: boolean;
    charts: boolean;
  };
  minimumSeverity: VulnerabilitySeverity;
}

export interface ApiResponse<T> {
  data: T;
  success: boolean;
  message?: string;
  errors?: string[];
}

// 背景掃描相關介面
export interface ScanTask {
  id: string;
  name: string;
  packages: PackageInfo[];
  config: ScanConfig;
  status: ScanTaskStatus;
  progress: ScanProgress;
  results?: {packageName: string, vulnerabilities: Vulnerability[]}[];
  createdAt: Date;
  startedAt?: Date;
  completedAt?: Date;
  estimatedDuration: number;
  actualDuration?: number;
  error?: string;
}

export type ScanTaskStatus = 'pending' | 'running' | 'paused' | 'completed' | 'failed' | 'cancelled';

export interface BackgroundScanState {
  activeTasks: ScanTask[];
  completedTasks: ScanTask[];
  lastScanId?: string;
}

export interface NotificationConfig {
  enabled: boolean;
  types: {
    scanCompleted: boolean;
    scanFailed: boolean;
    highSeverityFound: boolean;
  };
}