<mat-card class="vulnerability-card" [class]="'severity-' + vulnerability.severity.toLowerCase()">
  <mat-card-header>
    <div mat-card-avatar class="vulnerability-avatar">
      <mat-icon [class]="'severity-icon-' + vulnerability.severity.toLowerCase()">
        {{ getSeverityIcon(vulnerability.severity) }}
      </mat-icon>
    </div>
    <mat-card-title>{{ vulnerability.cveId }}</mat-card-title>
    <mat-card-subtitle>
      <mat-chip-set>
        <mat-chip 
          [class]="'severity-chip-' + vulnerability.severity.toLowerCase()"
          [highlighted]="true">
          {{ vulnerability.severity }}
        </mat-chip>
        <mat-chip class="score-chip" *ngIf="vulnerability.cvssScore > 0">
          CVSS {{ vulnerability.cvssScore.toFixed(1) }}
        </mat-chip>
      </mat-chip-set>
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <!-- CVSS 評分視覺化 -->
    <div class="cvss-section" *ngIf="vulnerability.cvssScore > 0">
      <div class="cvss-header">
        <mat-icon>bar_chart</mat-icon>
        <span>CVSS 風險評分</span>
      </div>
      <div class="cvss-bar">
        <mat-progress-bar 
          mode="determinate" 
          [value]="(vulnerability.cvssScore / 10) * 100"
          [class]="'cvss-bar-' + vulnerability.severity.toLowerCase()">
        </mat-progress-bar>
        <span class="cvss-score">{{ vulnerability.cvssScore.toFixed(1) }}/10</span>
      </div>
      <div class="cvss-vector" *ngIf="vulnerability.cvssVector">
        <small>{{ vulnerability.cvssVector }}</small>
      </div>
    </div>

    <!-- 漏洞描述 -->
    <div class="description-section">
      <p>{{ vulnerability.description }}</p>
    </div>

    <!-- 時間軸資訊 -->
    <div class="timeline-section">
      <div class="timeline-item">
        <mat-icon>publish</mat-icon>
        <div class="timeline-content">
          <span class="timeline-label">發布日期</span>
          <span class="timeline-date">{{ formatDate(vulnerability.publishedDate) }}</span>
        </div>
      </div>
      <div class="timeline-item" *ngIf="vulnerability.lastModifiedDate">
        <mat-icon>update</mat-icon>
        <div class="timeline-content">
          <span class="timeline-label">最後更新</span>
          <span class="timeline-date">{{ formatDate(vulnerability.lastModifiedDate) }}</span>
        </div>
      </div>
    </div>

    <!-- 詳細資訊展開面板 -->
    <mat-expansion-panel class="details-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>info</mat-icon>
          詳細資訊
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="details-content">
        <!-- 受影響版本 -->
        <div class="detail-section" *ngIf="vulnerability.affectedVersions?.length">
          <h4>
            <mat-icon>warning</mat-icon>
            受影響版本
          </h4>
          <mat-chip-set>
            <mat-chip *ngFor="let version of vulnerability.affectedVersions" class="version-chip">
              {{ version }}
            </mat-chip>
          </mat-chip-set>
        </div>

        <!-- 修復版本 -->
        <div class="detail-section" *ngIf="vulnerability.fixedVersion">
          <h4>
            <mat-icon>verified</mat-icon>
            修復版本
          </h4>
          <mat-chip class="fixed-version-chip" [highlighted]="true">
            {{ vulnerability.fixedVersion }}
          </mat-chip>
          <p class="fix-recommendation">
            <mat-icon>lightbulb</mat-icon>
            建議升級至此版本或更新版本以修復此漏洞
          </p>
        </div>

        <!-- 參考連結 -->
        <div class="detail-section" *ngIf="vulnerability.references?.length">
          <h4>
            <mat-icon>link</mat-icon>
            參考資料
          </h4>
          <div class="references-list">
            <a *ngFor="let reference of vulnerability.references" 
               [href]="reference" 
               target="_blank" 
               rel="noopener noreferrer"
               class="reference-link"
               matTooltip="在新分頁中開啟">
              <mat-icon>open_in_new</mat-icon>
              {{ getReferenceName(reference) }}
            </a>
          </div>
        </div>

        <!-- 威脅分析 -->
        <div class="detail-section threat-analysis">
          <h4>
            <mat-icon>psychology</mat-icon>
            威脅分析
          </h4>
          <div class="threat-content">
            <div class="threat-level" [class]="'threat-' + vulnerability.severity.toLowerCase()">
              <div class="threat-indicator">
                <mat-icon>{{ getThreatIcon(vulnerability.severity) }}</mat-icon>
                <span>{{ getThreatLevel(vulnerability.severity) }}</span>
              </div>
              <p>{{ getThreatDescription(vulnerability.severity) }}</p>
            </div>
            
            <div class="mitigation-suggestions">
              <h5>
                <mat-icon>security</mat-icon>
                緩解建議
              </h5>
              <ul>
                <li *ngFor="let suggestion of getMitigationSuggestions(vulnerability.severity)">
                  {{ suggestion }}
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-card-content>

  <mat-card-actions class="vulnerability-actions">
    <button mat-button 
            *ngIf="vulnerability.references?.length" 
            (click)="openFirstReference()"
            color="primary">
      <mat-icon>open_in_new</mat-icon>
      查看詳情
    </button>
    <button mat-button 
            *ngIf="vulnerability.fixedVersion"
            (click)="copyFixCommand()"
            matTooltip="複製升級指令">
      <mat-icon>content_copy</mat-icon>
      複製修復指令
    </button>
  </mat-card-actions>
</mat-card>